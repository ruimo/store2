@import java.time.format.DateTimeFormatter
@import java.time.LocalDateTime
@import play.api.i18n.{Messages => msg}
@import java.time.Instant

@(
  page: Int, pageSize: Int, orderBy: OrderBy,
  recs: PagedRecords[(UploadedFile, StoreUser)],
  imageDateFormatter: DateTimeFormatter,
  toLocalDateTime: Instant => LocalDateTime,
  removeForm: Form[RemoveFile],
  categoryName: String
)(
  implicit request: MessagesRequest[AnyContent],
  flash: Flash,
  loginSession: LoginSession
)

@import helper._

<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script src="@routes.Assets.versioned("javascripts/jquery-ui-1.12.1.custom/jquery-ui.min.js")"></script>
    <script src="@routes.Assets.versioned("javascripts/clipboard.js-master/dist/clipboard.min.js")"></script>
    <script src="@routes.Assets.versioned("javascripts/fileList.js")"></script>
    <link href="@routes.Assets.versioned("javascripts/jquery-ui-1.12.1.custom/jquery-ui.theme.min.css")" rel="stylesheet">
    <link href="@routes.Assets.versioned("javascripts/jquery-ui-1.12.1.custom/jquery-ui.min.css")" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="@routes.Assets.versioned("stylesheets/fileList.css")"/>
  </head>
  <body>
    @form(action = CSRF(routes.FileServer.remove(page, pageSize, orderBy.toString)), 'id -> "removeForm") {
      <input type="hidden" name="fileId" id="fileId">
    }

    <div class="fileList">
      @if(recs.isEmpty) {
        @Messages("recordEmpty")
      } else {
        @pagingPanel(recs, routes.FileServer.fileList(_, _, _, categoryName), 10, 25, 50)(implicitly, Some(loginSession))

        <table class="fileListTable">
          @recs.records.map { rec =>
            <tr class="row">
              <td class="fileName">
                <a target="_blank" href="@routes.FileServer.getFile(rec._1.id.get.value)">
                  @rec._1.fileName
                </a>
              </td>
              <td class="createdTime">@imageDateFormatter.format(toLocalDateTime(rec._1.createdTime))</td>
              <td class="createdUser">
                @rec._2.fullName
              </td>
              <td class="link">
                <span id="url@rec._1.id.get.value">@routes.FileServer.getFile(rec._1.id.get.value)</span>
                <button class="copyBtn" data-clipboard-target="#url@rec._1.id.get.value">@msg("copyToClipboard")</button>
              </td>
              <td class="removeFile">
                @if(loginSession.isSuperUser || loginSession.userId == rec._1.storeUserId) {
                  <button class="removeBtn" data-confirm='@Messages("deleteConfirm")' data-id="@rec._1.id.get.value"></button>
                }
              </td>
            </tr>
          }
        </table>
      }
    </div>
  </body>
</html>
