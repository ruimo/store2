@(
  id: Long,
  myForm: Form[CreateNews],
  siteDropDown: Seq[(String, String)],
  attachmentNames: Map[Int, String]
)(
  implicit request: MessagesRequest[AnyContent],
  loginSession: LoginSession,
  flash: play.api.mvc.Flash,
  shoppingCartItemRepo: ShoppingCartItemRepo,
  db: play.api.db.Database
)

@import helper._

@fileUpload(id: Long, idx: Int) = {
  <table class="fileUploadTable">
    <tr>
      <td class="pictureUrl" colspan="3">
        URL:
        <span id="pic@idx">@routes.NewsPictures.getPicture(id, idx)</span>
        <button class="copyButton" data-clipboard-target="#pic@idx">COPY</button>
      </td>
    </tr>
    <tr>
      <td class="picture"><img src="@routes.NewsPictures.getPicture(id, idx)"></td>
      <td class="upload">
        @form(action = CSRF(routes.NewsPictures.upload(id, idx)), 'enctype -> "multipart/form-data") {
          <input id="newsPictureUpload@idx" type="file" name="picture">
          <input id="newsPictureUploadSubmit@idx" type="submit" value='@Messages("register")'>
        }
      </td>
      <td class="remove">
        @form(action = CSRF(routes.NewsPictures.remove(id, idx))) {
          <input id="newsPictureRemove@idx" type="submit" value="@Messages("remove")">
        }
      </td>
    </tr>
  </table>
}

@attachmentUpload(id: Long, idx: Int) = {
  <table class="attachmentUploadTable">
    <tr>
      @attachmentNames.get(idx) match {
        case Some(name) => {
          <td class="pictureUrl" colspan="3">
            URL:
            <span id="attachment@idx">@routes.NewsPictures.getAttachment(id, idx, name)</span>
            <button class="copyButton" data-clipboard-target="#attachment@idx">COPY</button>
          </td>
        }
        case None => {
          <td class="pictureUrl" colspan="3"></td>
        }
      }
    </tr>
    <tr>
      <td class="name">@attachmentNames.get(idx).getOrElse("-")</td>
      <td class="upload">
        @form(action = CSRF(routes.NewsPictures.uploadAttachment(id, idx)), 'enctype -> "multipart/form-data") {
          <input id="newsAttachmentUpload@idx" type="file" name="attachment">
          <input id="newsAttachmentUploadSubmit@idx" type="submit" value='@Messages("register")'>
        }
      </td>
      @attachmentNames.get(idx) match {
        case Some(name) => {
          <td class="remove">
            @form(action = CSRF(routes.NewsPictures.removeAttachment(id, idx, name))) {
              <input id="newsAttachmentRemove@idx" type="submit" value="@Messages("remove")">
            }
          </td>
        }
        case None => {
          <td></td>
        }
      }
    </tr>
  </table>
}

@main(Messages("modifyNewsTitle"), Some(loginSession), contentCssClass = "adminContents") {
  <script src="@routes.Assets.versioned("javascripts/jquery.ui.datepicker-ja.js")" type="text/javascript"></script>
  <script src="@routes.Assets.versioned("javascripts/clipboard.js-master/dist/clipboard.min.js")" type="text/javascript"></script>
  <script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
  <script>
    $(function () {
        tinymce.init({
            selector:'textarea',
            plugins: "image,textcolor,link",
            toolbar: "forecolor backcolor"
        });
        var clipboard = new Clipboard('.copyButton');
    });
  </script>
} {
  <script type="text/javascript">
    $(function() {
      $("#releaseDateTextBox").datepicker({
        dateFormat: 'yy年mm月dd日'
      });
    });
  </script>
  <h1 class="title">@Messages("modifyNewsTitle")</h1>

  @flash.get("errorMessage").map { message =>
    <div class="globalErrorMessage">
      @message
    </div>
  }

  @if(myForm.hasErrors) {
    <div class="globalErrorMessage">
      @Messages("inputError")
    </div>
  }

  @flash.get("message").map { message =>
    <div class="message">
      @message
    </div>
  }

  @helper.form(action = helper.CSRF(routes.NewsMaintenance.modifyNews(id)), 'id -> "modifyNewsForm") {
    <input id="idValue" type="hidden" value="@id">

    @helper.inputText(
      myForm("title"),
      '_label -> Messages("newsTitle"), 'size -> 80, 'maxlength -> 255
    )

    @textarea(
      myForm("contents"), '_label -> Messages("newsContents"),
      'rows -> 15, 'cols -> 80, 'id -> "newsContents"
    )

    @inputText(
      myForm("releaseDate"),
      '_label -> Messages("releaseDate"), 'id-> "releaseDateTextBox"
    )

    @select(
      myForm("site"), siteDropDown, '_showConstraints -> false, 'id -> "siteDropDown"
    )
    <input type="submit" class="updateButton" value=@Messages("register")>
  }

  <h2 class="newsPicture">@Messages("newsPicture")</h2>

  @{(0 until 5) map { idx => fileUpload(id, idx)}}

  <h2 class="newsAttachment">@Messages("newsAttachment")</h2>

  @{(0 until 5) map { idx => attachmentUpload(id, idx)}}

  <div class="menuPanel">
    <br>
    <a class="backLink" href="@routes.NewsMaintenance.editNews()">
      @Messages("backTo", Messages("newsMaintenanceTitle"))
    </a>

    <br>
    @admin.backToAdminTop()
  </div>
}
